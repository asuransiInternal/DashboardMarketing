<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Approval Admin - Dashboard Marketing</title>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <script src="assets/js/config.js"></script>
  <script src="assets/js/auth.js"></script>
</head>
<body>
  <div style="max-width:900px;margin:36px auto;padding:20px;background:#fff;border-radius:12px;box-shadow:0 6px 24px rgba(0,0,0,0.06)">
    <h3>Approval Pendaftaran</h3>
    <div id="pendingList" style="margin-top:12px">Memuat...</div>
  </div>

  <div class="toast-wrap"></div>

<script>
  async function loadPending(){
    const res = await apiPost('getPendingUsers', {});
    const el = document.getElementById('pendingList');
    if(res.status !== 'ok'){ el.innerText = 'Gagal memuat'; return; }
    if(res.pending.length === 0){ el.innerHTML = '<div class="small">Tidak ada pendaftaran baru</div>'; return; }
    el.innerHTML = res.pending.map(u => {
      return `<div style="border:1px solid #eef2ff;border-radius:10px;padding:12px;margin-bottom:8px;display:flex;justify-content:space-between;align-items:center">
        <div>
          <div style="font-weight:700">${u.nama || '-'}</div>
          <div class="small">${u.email}</div>
          <div class="small">WA: ${u.whatsapp || '-'}</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center">
          <select id="role_${u.row}">
            <option value="Admin">Admin</option>
            <option value="Marketing">Marketing</option>
            <option value="Supervisor">Supervisor</option>
            <option value="User">User</option>
          </select>
          <button onclick="approve('${u.email}', document.getElementById('role_${u.row}').value)" class="btn">Approve</button>
        </div>
      </div>`;
    }).join('');
  }

  async function approve(email, role){
    const res = await apiPost('approveUser', { email: email, role: role });
    if(res.status === 'ok'){ toast('User diaktifkan'); loadPending(); }
    else toast(res.message || 'Gagal approve');
  }

  loadPending();
</script>
</body>
</html>
