<!-- dashboard.html -->
<!DOCTYPE html>
<html>
<head>
  <script src="assets/config.js"></script>
  <base target="_top">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>Dashboard</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>body{background:#f4f6fb;margin:0;font-family:Arial,Helvetica,sans-serif}.sidebar{width:250px;background:#fff;height:100vh;box-shadow:2px 0 12px rgba(0,0,0,0.04);position:fixed}.main{margin-left:250px;padding:20px}</style>
</head>
<body>
  <div class="sidebar p-3" id="sidebar">
    <!-- sidebar content will be loaded -->
  </div>
  <div class="main">
    <div class="d-flex justify-content-between align-items-center mb-4">
      <h4>Dashboard</h4>
      <div>
        <button class="btn btn-outline-secondary" onclick="logout()">Logout</button>
      </div>
    </div>
    <div id="content">
      <p>Halo, ini halaman dashboard. Konten akan disesuaikan berdasarkan role.</p>
      <div id="roleInfo"></div>
    </div>
  </div>

<script>
  // read token from querystring
  const params = new URLSearchParams(window.location.search);
  const token = params.get('token');

  function logout(){
    window.location.href = '?page=index';
  }

  // fetch session info from server by verifying token
  google.script.run.withSuccessHandler(function(session){
    if(!session){
      window.location.href='?page=index';
      return;
    }
    // session is an object: { email, role, created_at }
    document.getElementById('roleInfo').innerText = 'Anda login sebagai: ' + session.email + ' (Role: ' + session.role + ')';
    // Render sidebar options based on role
    renderSidebar(session.role);
  }).verifySessionToken(token);

  function renderSidebar(role){
    // For demo: a simple role -> menu mapping. Adjust according to TabelRoles via server later.
    let html = '<div class="mb-3"><strong>Menu</strong></div><ul class="list-unstyled">';
    if(role && role.toLowerCase().includes('admin')){
      html += '<li><a href="?page=approvalAdmin&token='+encodeURIComponent(token)+'">Approval Admin</a></li>';
      html += '<li><a href="?page=addMarketing&token='+encodeURIComponent(token)+'">Manage Marketing</a></li>';
    }
    if(role && role.toLowerCase().includes('marketing')){
      html += '<li><a href="?page=registerAplikasi&token='+encodeURIComponent(token)+'">Register Aplikasi</a></li>';
      html += '<li><a href="?page=registerPengiriman&token='+encodeURIComponent(token)+'">Register Pengiriman</a></li>';
    }
    html += '<li><a href="?page=marketingPlan&token='+encodeURIComponent(token)+'">Marketing Plan</a></li>';
    html += '</ul>';
    document.getElementById('sidebar').innerHTML = html;
  }
</script>
</body>
</html>
