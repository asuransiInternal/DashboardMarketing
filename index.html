<!-- index.html -->
<!DOCTYPE html>
<html>
  <head>
    <base target="_top">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Login - Dashboard Marketing</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
      body{background:#f5f7fb}
      .card{border-radius:12px;box-shadow:0 6px 18px rgba(0,0,0,0.08)}
      .toast-pos{position:fixed; right:16px; bottom:16px; z-index:9999}
      .eye{cursor:pointer}
    </style>
  </head>
  <body class="d-flex align-items-center justify-content-center vh-100">
    <div class="card p-4" style="width:360px;">
      <h4 class="mb-3 text-center">Masuk ke Dashboard</h4>
      <div class="mb-2">
        <label class="form-label">Email</label>
        <input id="email" type="email" class="form-control" placeholder="nama@gmail.com" />
      </div>
      <div class="mb-3 position-relative">
        <label class="form-label">Password</label>
        <input id="password" type="password" class="form-control" placeholder="Password" />
        <span class="position-absolute top-50 end-0 translate-middle-y me-3 eye" onclick="togglePass()">üëÅÔ∏è</span>
      </div>
      <div class="d-flex justify-content-between align-items-center mb-3">
        <a href="?page=signup" class="small">Belum punya akun? Daftar</a>
        <a href="?page=forgot-password" class="small">Lupa password?</a>
      </div>
      <button class="btn btn-primary w-100" onclick="doLogin()">Masuk</button>
    </div>

    <div id="toast" class="toast-pos"></div>

    <script>
      function togglePass(){
        const el = document.getElementById('password');
        el.type = (el.type === 'password') ? 'text' : 'password';
      }

      function showToast(msg){
        const div = document.createElement('div');
        div.className = 'alert alert-success';
        div.style.minWidth = '220px';
        div.innerText = msg;
        document.getElementById('toast').appendChild(div);
        setTimeout(()=> div.remove(), 3500);
      }

      function doLogin(){
        const email = document.getElementById('email').value;
        const password = document.getElementById('password').value;
        if(!email || !password){ showToast('Masukkan email & password'); return; }
        google.script.run.withSuccessHandler(function(resRaw){
          const res = JSON.parse(resRaw);
          if(res.status === 'ok'){
            // redirect to dashboard with token
            window.location.href = '?page=dashboard&token=' + encodeURIComponent(res.token);
          } else {
            showToast(res.message || 'Gagal login');
          }
        }).loginUser({email: email, password: password});
      }
    </script>
  </body>
</html>
