<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Login - Dashboard Marketing</title>
  <link rel="stylesheet" href="assets/css/style.css"/>
  <script src="assets/js/config.js"></script>
  <script src="assets/js/auth.js"></script>
  <script src="auth.js"></script>
</head>
<body>
  <div class="container">
    <div class="left">
      <div class="bg" id="leftBg">
        <div class="overlay"></div>
        <div class="hero">
          <div style="font-size:13px; opacity:0.9; margin-bottom:18px;">Dashboard Marketing</div>
          <h1>Monitoring<br/>Marketing Menjadi Mudah</h1>
          <p style="margin-top:18px; font-size:15px; max-width:420px;">
            Tracking aktifitas marketing, register aplikasi, pengiriman dan klaim â€” semua terpusat.
          </p>
        </div>
      </div>
    </div>

    <div class="right">
      <h2 style="margin:0 0 8px">Selamat Datang!</h2>
      <p class="small" style="margin-top:0;margin-bottom:18px;">Silakan masuk untuk melanjutkan.</p>

      <div class="form-group">
        <label for="email">Email</label>
        <input id="email" class="input" type="email" placeholder="nama@gmail.com" />
      </div>
      <div class="form-group">
        <label for="password">Password</label>
        <div style="position:relative">
          <input id="password" class="input" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
          <button id="eye" style="position:absolute; right:8px; top:8px; border:none; background:none; cursor:pointer">ğŸ‘ï¸</button>
        </div>
      </div>

      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
        <a class="small" href="signup.html">Belum punya akun? Daftar</a>
        <a class="small" href="forgot-password.html">Lupa Password?</a>
      </div>

      <button class="btn" id="btnLogin">MASUK</button>

      <div id="error" class="signup-msg" style="color:#c53030"></div>

      <div style="margin-top:16px; text-align:center; color:#9aa0b4">atau</div>
      <div style="margin-top:12px; display:flex; gap:8px">
        <button class="input" style="display:flex; align-items:center; justify-content:center; gap:8px;">Masuk dengan Google</button>
      </div>
    </div>
  </div>

  <div class="toast-wrap"></div>

  <script>
    // background image
    document.getElementById('leftBg').style.backgroundImage = "url('https://raw.githubusercontent.com/asuransiInternal/DashboardMarketing/main/file_000000006878722fb57ff4d6cf3e6877.png')";

    document.getElementById('eye').addEventListener('click', function(e){ e.preventDefault();
      const p = document.getElementById('password'); p.type = (p.type==='password')?'text':'password';
    });

    document.getElementById('btnLogin').addEventListener('click', async function(){
      const email = (document.getElementById('email').value||'').trim();
      const password = (document.getElementById('password').value||'').trim();
      document.getElementById('error').innerText = '';
      if(!email || !password){ document.getElementById('error').innerText = 'Masukkan email & password'; return; }
      if(!email.endsWith('@gmail.com')){ document.getElementById('error').innerText = 'Gunakan alamat Gmail'; return; }

      const clientHash = await sha256hex(password); // client-side SHA-256
      const res = await apiGet('login', { email: email, client_hash: clientHash });
      if(res.status === 'ok'){
        sessionStorage.setItem('dm_token', res.token);
        sessionStorage.setItem('dm_role', res.role || '');
        sessionStorage.setItem('dm_name', res.nama_lengkap || '');
        toast('Login berhasil');
        setTimeout(()=> { window.location.href = 'dashboard.html'; }, 800);
      } else {
        document.getElementById('error').innerText = res.message || 'Gagal login';
      }
    });
  </script>
</body>
</html>


